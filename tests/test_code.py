from main.func import load_function, filter_and_mask_account, sorted_list, data_transform



def test_filter_and_mask_account():
  assert filter_and_mask_account([{"id": 957763565,"state": "EXECUTED","date": "2019-01-05T00:52:30.108534","operationAmount": {"amount": "87941.37","currency": {"name": "руб.","code": "RUB"}},"description": "Перевод со счета на счет","from": "Счет 46363668439560358409","to": "Счет 18889008294666828266"}]) == [{'date': '2019-01-05', 'description': 'Перевод со счета на счет', 'from': 'Счет 4636 36 ** **** 8409', 'to': 'Счет **8266', 'amount': '87941.37', 'name': 'руб.'}]
  assert filter_and_mask_account([{"id": 957763565,"operationAmount": {"amount": "87941.37","currency": {"name": "руб.","code": "RUB"}},"description": "Перевод со счета на счет","from": "Счет 46363668439560358409","to": "Счет 18889008294666828266"}]) == []

def test_sorted_list():
  assert sorted_list([{'date': '2019-08-19', 'description': 'Перевод организации', 'from': 'Счет 1769 13 ** **** 4901', 'to': 'Счет **7621', 'amount': '81150.87', 'name': 'USD'}, {'date': '2018-12-22', 'description': 'Перевод с карты на карту', 'from': 'Visa Gold  83 ** **** 6459', 'to': 'Master **1847', 'amount': '56516.63', 'name': 'USD'}, {'date': '2019-05-19', 'description': 'Перевод организации', 'from': 'МИР  52 ** **** 8469', 'to': 'Счет **2662', 'amount': '6381.58', 'name': 'USD'}, {'date': '2012-03-09', 'description': 'Перевод организации', 'from': 'Счет 2640 62 ** **** 3262', 'to': 'Счет **1315', 'amount': '25780.71', 'name': 'руб.'}]
) == [{'date': '2019-08-19', 'description': 'Перевод организации', 'from': 'Счет 1769 13 ** **** 4901', 'to': 'Счет **7621', 'amount': '81150.87', 'name': 'USD'}, {'date': '2019-05-19', 'description': 'Перевод организации', 'from': 'МИР  52 ** **** 8469', 'to': 'Счет **2662', 'amount': '6381.58', 'name': 'USD'}, {'date': '2018-12-22', 'description': 'Перевод с карты на карту', 'from': 'Visa Gold  83 ** **** 6459', 'to': 'Master **1847', 'amount': '56516.63', 'name': 'USD'}, {'date': '2012-03-09', 'description': 'Перевод организации', 'from': 'Счет 2640 62 ** **** 3262', 'to': 'Счет **1315', 'amount': '25780.71', 'name': 'руб.'}]


def test_data_transform():
  assert data_transform([{'date': '2019-08-19', 'description': 'Перевод организации', 'from': 'Счет 1769 13 ** **** 4901', 'to': 'Счет **7621', 'amount': '81150.87', 'name': 'USD'}, {'date': '2018-12-22', 'description': 'Перевод с карты на карту', 'from': 'Visa Gold  83 ** **** 6459', 'to': 'Master **1847', 'amount': '56516.63', 'name': 'USD'}, {'date': '2019-05-19', 'description': 'Перевод организации', 'from': 'МИР  52 ** **** 8469', 'to': 'Счет **2662', 'amount': '6381.58', 'name': 'USD'}, {'date': '2012-03-09', 'description': 'Перевод организации', 'from': 'Счет 2640 62 ** **** 3262', 'to': 'Счет **1315', 'amount': '25780.71', 'name': 'руб.'}]
) == [{'date': '19.08.2019', 'description': 'Перевод организации', 'from': 'Счет 1769 13 ** **** 4901', 'to': 'Счет **7621', 'amount': '81150.87', 'name': 'USD'}, {'date': '22.12.2018', 'description': 'Перевод с карты на карту', 'from': 'Visa Gold  83 ** **** 6459', 'to': 'Master **1847', 'amount': '56516.63', 'name': 'USD'}, {'date': '19.05.2019', 'description': 'Перевод организации', 'from': 'МИР  52 ** **** 8469', 'to': 'Счет **2662', 'amount': '6381.58', 'name': 'USD'}, {'date': '09.03.2012', 'description': 'Перевод организации', 'from': 'Счет 2640 62 ** **** 3262', 'to': 'Счет **1315', 'amount': '25780.71', 'name': 'руб.'}]

def test_load_function():
  assert load_function('operations_small.json') == [{'id': 441945886, 'state': 'EXECUTED', 'date': '2019-08-26T10:50:58.294041', 'operationAmount': {'amount': '31957.58', 'currency': {'name': 'руб.', 'code': 'RUB'}}, 'description': 'Перевод организации', 'from': 'Maestro 1596837868705199', 'to': 'Счет 64686473678894779589'}, {'id': 41428829, 'state': 'EXECUTED', 'date': '2019-07-03T18:35:29.512364', 'operationAmount': {'amount': '8221.37', 'currency': {'name': 'USD', 'code': 'USD'}}, 'description': 'Перевод организации', 'from': 'MasterCard 7158300734726758', 'to': 'Счет 35383033474447895560'}, {'id': 939719570, 'state': 'EXECUTED', 'date': '2018-06-30T02:08:58.425572', 'operationAmount': {'amount': '9824.07', 'currency': {'name': 'USD', 'code': 'USD'}}, 'description': 'Перевод организации', 'from': 'Счет 75106830613657916952', 'to': 'Счет 11776614605963066702'}]
